# iOS 用户体验设计指南

## 核心原则

> **清晰、尊重、流畅**（Apple 人机交互指南）

---

## 1. 时间输入

### 组件

**`UIDatePicker`** 使用 `.timeInterval` 模式，或**自定义滚轮选择器**

### 交互

- **滚动选择**：在滚轮组件上垂直滑动
- **快速调整**：选择器下方提供 `+15m`、`+30m`、`-15m` 按钮
- **智能默认值**：预填充上次使用的时间

### 布局

```
┌─────────────────────────────────────┐
│            就寝时间                  │
│            晚上 10:30               │
│    ┌───┐   ┌───┐                   │
│    │ ▲ │   │ ▼ │   小时            │
│    └───┘   └─────────────────────┐ │
│    ┌───┐   ┌───┐                 │ │
│    │ ▲ │   │ ▼ │   分钟          │ │
│    └───┘   └─────────────────────┘ │
├─────────────────────────────────────┤
│   [-15m]  [+15m]  [+30m]  [+1h]    │
└─────────────────────────────────────┘

✓ 将选择器放在表单或内联展示
✓ 在下方显示时长提示（例如"推荐 8 小时"）
```

### 睡眠特定功能

- 当就寝时间 > 起床时间时，自动计算睡眠时长
- 适用时显示跨天指示器

---

## 2. 选择

### 组件

- **`.menu`**：上下文操作
- **`.confirmationDialog`**：二元选择
- **Picker / Stepper**：数字选择

### 交互

- **点击展开**：全屏表单或弹出框
- **最近优先**：按使用频率排序

### 布局

```
睡眠目标
┌─────────────────────────────────────┐
│                                     │
│    6   7   8   9   10   11   12     │
│    ○   ●   ●   ○   ○    ○    ○     │
│          小时                       │
│                                     │
├─────────────────────────────────────┤
│  范围：4 - 12 小时                  │
└─────────────────────────────────────┘

✓ 3-12 个数字选项使用 Picker
✓ 直接点击选择，自动保存
```

---

## 3. 数字输入

### 组件

- **`.stepper`**：`-` / `+` 按钮
- **Slider**：带数值标签
- **TextField**：带键盘

### 交互

- **Stepper 点击**：按步进值增减
- **Slider 拖动**：连续调整
- **键盘点击**：直接数字输入

### 布局

```
┌─────────────────────────────────────┐
│          睡眠时长                    │
│              7.5 小时                │
│                                     │
│    ┌─────┐                          │
│    │  -  │    ───────────●────────  │
│    └─────┘               7.5        │
│    ┌─────┘         4         12     │
│    │  +  │                          │
│    └─────┘                          │
├─────────────────────────────────────┤
│  范围：4 - 12 小时                  │
└─────────────────────────────────────┘

✓ SF Symbols：`minus`、`plus`、`capsule.fill`
✓ Slider 下方显示最小/最大标签
✓ 离散值使用 Stepper（0.5 小时）
```

---

## 4. 表单编辑

### 组件

- **`.sheet`**：模态表单展示
- **NavigationStack**：跳转到详情视图

### 交互

- **点击展开**：展示表单或导航
- **自动保存**：关闭时保存，无需保存按钮
- **放弃**：向下滑动关闭

### 流程

```
查看模式                    编辑模式
┌─────────────────────┐   ┌─────────────────────┐
│  就寝时间            │   │  就寝时间            │
│  ▸ 晚上 10:30      ───▶│  晚上 10:30         │
│                     │   │  ┌───┐   ┌───┐     │
│                     │   │  │ ▲ │   │ ▼ │     │
│                     │   │  └───┘   └───┘     │
│                     │   │                     │
│                     │   │      取消    保存   │
└─────────────────────┘   └─────────────────────┘
        ↓ 向下滑动关闭
```

### 指南

- **1-3 个字段**：在表单中编辑
- **4+ 个字段**：导航进入
- **无需保存按钮**：关闭时自动保存
- **确认放弃**：如果有未保存的更改

---

## 5. 日期选择

### 组件

**`UIDatePicker`** 使用 `.graphical` 或 `.compact` 样式

### 交互

- **点击日期**：打开日期选择器
- **快速导航**：今天 / 昨天 / 本周
- **滑动月份**：在日历上水平滑动

### 布局

```
┌─────────────────────────────────────┐
│  <    2024 年 12 月    >            │
│                                     │
│    S   M   T   W   T   F   S       │
│   25  26  27  28  29  30   1       │
│    2   3   4   5   6   7   8       │
│    9  10  11  12  13  14  15       │
│   16  17  18  19  20  21  22       │
│   23  24  25  26  27  28  29       │
│   30  31                           │
│                                     │
├─────────────────────────────────────┤
│  [今天]  [昨天]  [本周]             │
└─────────────────────────────────────┘

✓ 日期范围选择使用 `.graphical`
✓ 单个日期内联使用 `.compact`
✓ 有记录的日期显示圆点指示器
```

---

## 6. 列表操作

### 组件

- **滑动操作**：左侧/右侧
- **编辑模式**：批量选择

### 交互

- **左滑**：显示删除操作
- **右滑**：显示次要操作
- **长按**：进入编辑模式
- **点击复选框**：多选

### 布局

```
┌─────────────────────────────┐
│  Q   今天                    │
├─────────────────────────────┤
│  ○  7h 30m                  │
│     晚上 10:30 → 早上 6:00   │
├─────────────────────────────┤
│  ○  8h 15m                  │
│     晚上 11:00 → 早上 7:15   │
└─────────────────────────────┘
        ↑ 右滑        ↓ 左滑
┌─────────────────────────────┐
│  [置顶]        [删除]       │
└─────────────────────────────┘

✓ 删除使用 `.destructive`（红色）
✓ 警告操作使用 `.warning`（橙色）
✓ 次要操作使用 `.idle`（灰色）
✓ 每侧最多 2 个滑动操作
```

### 编辑模式

```
┌─────────────────────────────┐
│  取消          删除（2）     │
├─────────────────────────────┤
│  ☑  7h 30m                  │
│  ☑  8h 15m                  │
│     9h 00m                  │
├─────────────────────────────┤
│         [添加到收藏夹]       │
└─────────────────────────────┘
```

---

## 7. 反馈

### 组件

- **Toast**：简短确认（SwiftUI）
- **Alert**：需要用户操作的错误
- **Banner**：持久消息
- **ProgressView**：加载状态

### 使用

```
✓ Toast（1-2秒）：操作成功
┌─────────────────────────────┐
│  ✓ 已保存                    │
└─────────────────────────────┘

✓ Alert（需要用户操作）：
┌─────────────────────────────┐
│  删除记录？                  │
│                             │
│  此操作无法撤销。            │
│                             │
│      取消    删除            │
└─────────────────────────────┘

✓ Banner（持久信息）：
┌─────────────────────────────┐
│  ⚠️ 需要 iCloud 同步         │
│  登录以同步数据              │
└─────────────────────────────┘

✓ ProgressView（加载中）：
┌─────────────────────────────┐
│     ⏳ 加载中...            │
└─────────────────────────────┘
```

### 指南

- **Toast**：最多 2 行，自动关闭
- **Alert**：最多 2 个按钮（取消 + 操作）
- **Banner**：屏幕顶部，滑动关闭
- **骨架屏**：内容加载时显示

---

## 8. 导航

### 结构

- **TabBar**：顶层分类（最多 5 个）
- **NavigationStack**：层级内容
- **Sheet**：次要内容

### Tab 结构

```
┌─────────────────────────────┐
│          睡眠记录            │
├─────────────────────────────┤
│                             │
│        [统计数据]            │
│                             │
│                             │
├─────────────────────────────┤
│  📊    📝    📅    ⚙️       │
│  记录   日历   统计   设置   │
└─────────────────────────────┘
```

---

## 9. 无障碍

### 要求

- **动态字体**：支持 `.largeTitle` → `.caption1`
- **触觉反馈**：使用 `UIImpactFeedbackGenerator`
- **VoiceOver**：正确的无障碍标签
- **颜色**：WCAG AA 对比度（4.5:1）

### 示例

```swift
Button(action: save) {
  Label("保存", systemImage: "checkmark.circle.fill")
}
.accessibilityLabel("保存睡眠记录")
.accessibilityHint("双击保存")
```

---

## 优先级矩阵

| 优先级 | 功能 | 复杂度 |
|--------|------|--------|
| P0 | 快速记录 | 低 |
| P0 | 时间调整 | 低 |
| P1 | 睡眠统计 | 中 |
| P1 | 日历视图 | 中 |
| P2 | 标签管理 | 中 |
| P2 | 数据导出 | 高 |
| P3 | 云同步 | 高 |

---

## 设计资源

- **SF Symbols**：`A` → `Z` + 数字 + 符号
- **系统颜色**：Primary、Secondary、Tertiary
- **圆角**：10pt（默认）、20pt（卡片）
- **间距**：8pt 网格系统
